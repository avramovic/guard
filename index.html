<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Guard</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Guard</h1>
        <h2>Linux CLI application used to protect files and folders on server in real time.</h2>

        <section id="downloads">
          <a href="#installation" class="btn">Installation</a>
          <a href="https://github.com/avramovic/guard/zipball/master" class="btn">Download source (zip)</a>
          <a href="https://github.com/avramovic/guard/tarball/master" class="btn">Download source (tar.gz)</a>
          <a href="https://github.com/avramovic/guard" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a id="about" class="anchor" href="#about" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>About</h1>

<p>Guard is a Linux CLI application which relies on inotify-tools to watch multiple folders (usually containing web sites). Whenever a file is created, modified or deleted within a watched folder(s), the action will be reversed and event will be logged. Then you can list, allow or forget (remove) blocked events.</p>

<p>It can also send e-mail notification about modified files.</p>

<h1>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Requirements</h1>

<ul>
<li>PHP 5.5.9 or greater (PHP 7 highly recommended)</li>
<li><a href="https://github.com/rvoicilas/inotify-tools/wiki">inotify-tools</a></li>
</ul>

<p>If you don't have inotify-tools installed the app will fail miserably. Make sure you <a href="https://github.com/rvoicilas/inotify-tools/wiki#getting">have it installed</a> before continuing!!!</p>

<h1>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h1>

<p>Installation is very easy, you can choose to have it installed via <code>curl</code> or <code>wget</code>.</p>

<p>For cURL, type this into your command line:</p>

<pre><code>curl -LSs http://avramovic.github.io/guard/installer | php
</code></pre>

<p>Alternatively, you can try with wget:</p>

<pre><code>wget -q -O - "$@" http://avramovic.github.io/guard/installer | php
</code></pre>

<p>The installer will check your PHP configuration and will let you know if everything is okay. Once done, you can check installed version with:</p>

<pre><code>php guard.phar --version
</code></pre>

<h2>
<a id="global-installation" class="anchor" href="#global-installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Global installation</h2>

<p>To install Guard globally, simply move it to any folder which is in your PATH:</p>

<pre><code>mv guard.phar /usr/local/bin/guard
</code></pre>

<blockquote>
<p><strong>Note</strong>: If the above fails due to permissions, you may need to run it again with sudo. (sudo !!)<br>
<strong>Note</strong>: For information on changing your PATH, please read the <a href="https://en.wikipedia.org/wiki/PATH_(variable)">Wikipedia article</a> and/or use Google.</p>
</blockquote>

<p>From now on, you should be able to call Guard with guard command only:</p>

<pre><code>guard --version
</code></pre>

<p>If it works, you can substitute <code>php guard.phar</code> with <code>guard</code> in all following commands.</p>

<h1>
<a id="quickstart" class="anchor" href="#quickstart" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Quickstart</h1>

<p>Let's say your site <em>example.com</em> is located in <code>/home/example/public_html</code> and you want to protect it. First, let's add that path to the watch list:</p>

<pre><code>php guard.phar site:add example.com --path=/home/example/public_html
</code></pre>

<p>If it says <em>Site example.com added!</em> you're ready to go.</p>

<blockquote>
<p><strong>Note</strong>: By default, Guard is watching for changes only on the following file types: <code>*.php;*.htm*;*.js;*.css;*.sql</code>. You can use <code>--types=TYPES</code> to specify your own file types to watch. Use <code>*</code> to watch them all (NOT recommended)   </p>
</blockquote>

<p>Now, start the watcher and that's it:</p>

<pre><code>php guard.phar start &amp;
</code></pre>

<blockquote>
<p><strong>Note</strong>: Because start is a continious (never-ending) command, we're adding &amp; at the end to run it in the background.</p>
</blockquote>

<h1>
<a id="commands" class="anchor" href="#commands" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Commands</h1>

<p>Guard offers variety of commands to make your life easier. Let's review them all!</p>

<blockquote>
<p><strong>Note</strong>: To see all available commands, use <code>php guard.phar</code><br>
<strong>Note</strong>: To get help about individual command, <code>use php guard.phar help COMMAND</code></p>
</blockquote>

<h2>
<a id="site-commands" class="anchor" href="#site-commands" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Site commands</h2>

<p>These commands are used to work with your site(s).</p>

<h3>
<a id="siteadd" class="anchor" href="#siteadd" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>site:add</h3>

<p>This command is used to add site to the watched list. All files from the supplied path will be backed up.</p>

<pre><code>Usage:
  site:add [options] [--] &lt;name&gt;

Arguments:
  name                     Name of the site. Usually the domain name

Options:
  -p, --path=PATH          Path to guard [default: "."]
  -t, --types=TYPES        File extensions to protect [default: "*.php;*.htm*;*.js;*.css;*.sql"]
  -e, --email=EMAIL        Email address for notifications
  -x, --excludes=EXCLUDES  Paths to exclude (multiple values allowed)
</code></pre>

<blockquote>
<p><strong>Note</strong>: Name can be any valid folder name but to make everything easier you should always use your site domain name here.<br>
<strong>Note</strong>: You must restart Guard (stop/start) after using this command for the changes to take effect.</p>
</blockquote>

<h4>
<a id="examples" class="anchor" href="#examples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example(s)</h4>

<p>Protect only html files in the current directory:</p>

<pre><code>php guard.phar site:add example.com --types=*.html
</code></pre>

<p>Protect default files in the custom directory and set e-mail for notifications:</p>

<pre><code>php guard.phar site:add example.com --path=/home/example/public_html --email=you@example.com
</code></pre>

<h3>
<a id="sitebackup" class="anchor" href="#sitebackup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>site:backup</h3>

<p>This command is used to backup all files from site's path.</p>

<h4>
<a id="examples-1" class="anchor" href="#examples-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example(s)</h4>

<p>Refresh backup of the site <em>example.com</em>:</p>

<pre><code>php guard.phar site:backup example.com
</code></pre>

<h3>
<a id="sitelist" class="anchor" href="#sitelist" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>site:list</h3>

<p>This command is used to show existing protected sites.</p>

<h4>
<a id="examples-2" class="anchor" href="#examples-2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example(s)</h4>

<p>List all guarded sites:</p>

<pre><code>php guard.phar site:list
</code></pre>

<h3>
<a id="siteremove" class="anchor" href="#siteremove" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>site:remove</h3>

<p>This command is used to remove site from being protected.</p>

<blockquote>
<p><strong>Note</strong>: You must restart Guard (stop/start) after using this command for the changes to take effect.</p>
</blockquote>

<h4>
<a id="examples-3" class="anchor" href="#examples-3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example(s)</h4>

<p>Remove site <em>example.com</em> from being protected:</p>

<pre><code>php guard.phar site:remove example.com
</code></pre>

<h3>
<a id="siteset" class="anchor" href="#siteset" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>site:set</h3>

<p>This command is used to set individual options for one site.</p>

<pre><code>Usage:
   site:set &lt;name&gt; &lt;variable&gt; &lt;value&gt; (&lt;value&gt;)...

 Arguments:
   name                  Site name
   variable              Variable name to set (can be: name, path, email, types or excludes)
   value                 Variable value (or values for excludes, separated with space) to set
</code></pre>

<blockquote>
<p><strong>Note</strong>: You must restart Guard (stop/start) after using this command for the changes to take effect.</p>
</blockquote>

<h4>
<a id="examples-4" class="anchor" href="#examples-4" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example(s)</h4>

<p>Change name of the site:</p>

<pre><code>php guard.phar site:set example.com name othername.org
</code></pre>

<p>Set/change email for notifications about this site:</p>

<pre><code>php guard.phar site:set example.com email you@othername.org
</code></pre>

<p>Set new excludes for the site (removing old excludes):</p>

<pre><code>php guard.phar site:set example.com excludes /home/example/public_html/excluded ./public_html/uploads
</code></pre>

<blockquote>
<p><strong>Note</strong>: Setting excludes using this method will <strong>remove</strong> existing excludes. See below for alternatives.</p>
</blockquote>

<h2>
<a id="exclude-commands" class="anchor" href="#exclude-commands" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exclude commands</h2>

<p>These commands are used to work with your sites' excludes.</p>

<h3>
<a id="excludeadd" class="anchor" href="#excludeadd" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>exclude:add</h3>

<p>Add folder to site excludes.</p>

<blockquote>
<p><strong>Note</strong>: You must restart Guard (stop/start) after using this command for the changes to take effect.</p>
</blockquote>

<h4>
<a id="examples-5" class="anchor" href="#examples-5" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example(s)</h4>

<p>Add folder to site excludes:</p>

<pre><code>php guard.phar exclude:add example.com /path/to/excluded/folder
</code></pre>

<h3>
<a id="excluderemove" class="anchor" href="#excluderemove" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>exclude:remove</h3>

<p>Remove folder from site excludes.</p>

<blockquote>
<p><strong>Note</strong>: You must restart Guard (stop/start) after using this command for the changes to take effect.</p>
</blockquote>

<h4>
<a id="examples-6" class="anchor" href="#examples-6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example(s)</h4>

<p>Remove folder from site excludes:</p>

<pre><code>php guard.phar exclude:remove example.com /path/to/excluded/folder
</code></pre>

<h2>
<a id="event-commands" class="anchor" href="#event-commands" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Event commands</h2>

<p>These commands are used to work with blocked events.</p>

<h3>
<a id="eventlist" class="anchor" href="#eventlist" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>event:list</h3>

<p>List all blocked events.</p>

<h4>
<a id="examples-7" class="anchor" href="#examples-7" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example(s)</h4>

<p>Remove folder to site excludes:</p>

<pre><code>php guard.phar event:list
</code></pre>

<h3>
<a id="eventdiff" class="anchor" href="#eventdiff" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>event:diff</h3>

<p>Show a diff between original file and the blocked action.</p>

<h4>
<a id="examples-8" class="anchor" href="#examples-8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example(s)</h4>

<p>Show a diff between original file and the blocked action with number 2:</p>

<pre><code>php guard.phar event:diff 2
</code></pre>

<h3>
<a id="eventallow" class="anchor" href="#eventallow" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>event:allow</h3>

<p>Allow blocked event to occur.</p>

<h4>
<a id="examples-9" class="anchor" href="#examples-9" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example(s)</h4>

<p>Allow blocked event to occur with number 2:</p>

<pre><code>php guard.phar event:allow 2
</code></pre>

<p>Allow all blocked events to occur.</p>

<pre><code>php guard.phar event:allow all
</code></pre>

<blockquote>
<p><strong>Note</strong>: Be very careful when allowing ALL events. Study all the events with event:list and remove suspicious events first!</p>
</blockquote>

<h3>
<a id="eventremove" class="anchor" href="#eventremove" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>event:remove</h3>

<p>Forget (remove) blocked event.</p>

<h4>
<a id="examples-10" class="anchor" href="#examples-10" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example(s)</h4>

<p>Remove blocked event to occur with number 3:</p>

<pre><code>php guard.phar event:remove 3
</code></pre>

<p>Remove all blocked events without asking for confirmation:</p>

<pre><code>php guard.phar event:remove all --silent
</code></pre>

<h2>
<a id="email-commands" class="anchor" href="#email-commands" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Email commands</h2>

<p>One neat feature of Guard is to send you email notifications when events are blocked. It can send mail using three different transports:</p>

<ul>
<li>mail - Use PHP's mail() function to send emails. This is the default transport.</li>
<li>sendmail - Use sendmail to send emails. You'll need to have sendmail installed on your server.</li>
<li>smtp - Use SMTP server to send emails. It supports no encryption, ssl and tls encryption. This is preferred transport.</li>
</ul>

<p>You should set up a cron job to call <code>email:notify</code> at regular intervals to notify you about new changes on site files. See examples below.</p>

<h3>
<a id="emailshow" class="anchor" href="#emailshow" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>email:show</h3>

<p>Show current email configuration.</p>

<h4>
<a id="examples-11" class="anchor" href="#examples-11" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example(s)</h4>

<p>Show current email configuration:</p>

<pre><code>php guard.phar email:show
</code></pre>

<h3>
<a id="emailset" class="anchor" href="#emailset" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>email:set</h3>

<p>Set email configuration variable.</p>

<pre><code>Usage:
   email:set &lt;variable&gt; &lt;value&gt; (&lt;value&gt;)...

 Arguments:
   variable              Variable name to set (can be: recipient, transport, sendmail, smtp_host, smtp_port, smtp_user, smtp_pass or smtp_encrypt)
   value                 Variable value to set
</code></pre>

<blockquote>
<p><strong>Note</strong>: You must restart Guard (stop/start) after using this command for the changes to take effect.</p>
</blockquote>

<h4>
<a id="examples-12" class="anchor" href="#examples-12" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example(s)</h4>

<p>Change email transport to sendmail:</p>

<pre><code>php guard.phar email:set transport sendmail
</code></pre>

<p>Set sendmail command path:</p>

<pre><code>php guard.phar email:set sendmail "/usr/bin/sendmail -bs"
</code></pre>

<p>Set default recipient(s) for all e-mails:</p>

<pre><code>php guard.phar email:set address you@example.com someoneelse@gmail.com
</code></pre>

<p>Change email transport to SMTP:</p>

<pre><code>php guard.phar email:set transport smtp
</code></pre>

<p>Set up SMTP:</p>

<pre><code>php guard.phar email:set smtp_host mail.example.com
php guard.phar email:set smtp_port 465
php guard.phar email:set smtp_user example
php guard.phar email:set smtp_pass your-password
php guard.phar email:set smtp_encrypt tls
</code></pre>

<h3>
<a id="emailtest" class="anchor" href="#emailtest" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>email:test</h3>

<p>Send a test email to the default recipient(s) or custom email address.</p>

<h4>
<a id="examples-13" class="anchor" href="#examples-13" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Examples</h4>

<p>Send a test email to the default recipient(s):</p>

<pre><code>php guard.phar email:test
</code></pre>

<p>Send a test email to the custom email address:</p>

<pre><code>php guard.phar email:test someoneelse@example.com
</code></pre>

<h3>
<a id="emailnotify" class="anchor" href="#emailnotify" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>email:notify</h3>

<p>Send email notifications about new blocked file events.</p>

<blockquote>
<p><strong>Note</strong>: When sending these emails FROM email address will be set to guard-notifications@YOUR-SITE-NAME, if YOUR-SITE-NAME is a valid domain name. Otherwise, it will be the same address as the site's email address (so it'll look like you're sending an email to yourself).</p>
</blockquote>

<h4>
<a id="examples-14" class="anchor" href="#examples-14" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example(s)</h4>

<p>Set up a cron job to send you email notifications every 5 minutes (if any new blocked events occur since last notification):</p>

<pre><code>*/5 * * * * php /full/path/to/guard.phar email:notify &gt;/dev/null 2&gt;&amp;1
</code></pre>

<h2>
<a id="service-commands" class="anchor" href="#service-commands" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Service commands</h2>

<p>These are service commands used to start/stop and update Guard.</p>

<h3>
<a id="status" class="anchor" href="#status" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>status</h3>

<p>Shows if Guard is currently running:</p>

<pre><code>php guard.phar status
</code></pre>

<h3>
<a id="start" class="anchor" href="#start" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>start</h3>

<p>Start Guard (in background) if not running:</p>

<pre><code>php guard.phar start &amp;
</code></pre>

<h3>
<a id="stop" class="anchor" href="#stop" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>stop</h3>

<p>Stop Guard if running:</p>

<pre><code>php guard.phar stop
</code></pre>

<h3>
<a id="update" class="anchor" href="#update" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>update</h3>

<p>Update Guard to the latest version:</p>

<pre><code>php guard.phar update
</code></pre>

<p>Rollback Guard to the previous version:</p>

<pre><code>php guard.phar update --rollback
</code></pre>

<blockquote>
<p><strong>Note</strong>: If you have Guard installed globally, you may need to run this command with sudo!</p>
</blockquote>
      </section>
    </div>

    
  </body>
</html>
